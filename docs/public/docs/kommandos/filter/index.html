<!DOCTYPE html>
<html lang="de-DE" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="filter # Mithilfe des filter-Kommandos können Datensätze anhand eines Kriterums aus der Eingabe gefiltert werden.
Beschreibung # Das filter-Kommando bildet das Herzstück des Toolkits. Es ermöglicht es, aus einer (mitunter sehr großen) Datenmenge, bspw. dem Gesamtabzug des Katalogsystems, eine kleinere Menge effizient zu extrahieren, um sie anschließend weiterzuverarbeiten. Dies erfolgt über die Angabe eines Filterausdrucks, der darüber entscheidet, ob ein Datensatz in die Zielmenge eingeht oder nicht.
Im folgenden Beispiel werden alle Datensätze aus der Datei DUMP.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="filter # Mithilfe des filter-Kommandos können Datensätze anhand eines Kriterums aus der Eingabe gefiltert werden.
Beschreibung # Das filter-Kommando bildet das Herzstück des Toolkits. Es ermöglicht es, aus einer (mitunter sehr großen) Datenmenge, bspw. dem Gesamtabzug des Katalogsystems, eine kleinere Menge effizient zu extrahieren, um sie anschließend weiterzuverarbeiten. Dies erfolgt über die Angabe eines Filterausdrucks, der darüber entscheidet, ob ein Datensatz in die Zielmenge eingeht oder nicht.
Im folgenden Beispiel werden alle Datensätze aus der Datei DUMP." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deutsche-nationalbibliothek.github.io/pica-rs/book/docs/kommandos/filter/" /><meta property="article:section" content="docs" />

<meta property="article:modified_time" content="2024-02-24T07:15:37+01:00" />

<title>Filter | pica-rs</title>
<link rel="manifest" href="/pica-rs/book/manifest.json">
<link rel="icon" href="/pica-rs/book/favicon.png" >
<link rel="canonical" href="https://deutsche-nationalbibliothek.github.io/pica-rs/book/docs/kommandos/filter/">
<link rel="stylesheet" href="/pica-rs/book/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous"><!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/pica-rs/book/"><span>pica-rs</span>
  </a>
</h2>













  



  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/pica-rs/book/docs/anleitungen/" class="">Anleitungen</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/installation/" class="">Installation</a>
  

        </li>
      
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/" class="">Kommandos</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/cat/" class="">Cat</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/completions/" class="">Completions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/convert/" class="">Convert</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/count/" class="">Count</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/explode/" class="">Explode</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/filter/" class="active">Filter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/frequency/" class="">Frequency</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/hash/" class="">Hash</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/invalid/" class="">Invalid</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/partition/" class="">Partition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/print/" class="">Print</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/slice/" class="">Slice</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/pica-rs/book/docs/kommandos/split/" class="">Split</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/pica-rs/book/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Filter</strong>

  <label for="toc-control">
    
  </label>
</div>


  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="filter">
  filter
  <a class="anchor" href="#filter">#</a>
</h1>
<p>Mithilfe des <code>filter</code>-Kommandos können Datensätze anhand eines Kriterums
aus der Eingabe gefiltert werden.</p>
<h2 id="beschreibung">
  Beschreibung
  <a class="anchor" href="#beschreibung">#</a>
</h2>
<p>Das <code>filter</code>-Kommando bildet das Herzstück des Toolkits. Es ermöglicht
es, aus einer (mitunter sehr großen) Datenmenge, bspw. dem Gesamtabzug
des Katalogsystems, eine kleinere Menge effizient zu extrahieren, um sie
anschließend weiterzuverarbeiten. Dies erfolgt über die Angabe eines
Filterausdrucks, der darüber entscheidet, ob ein Datensatz in die
Zielmenge eingeht oder nicht.</p>
<p>Im folgenden Beispiel werden alle Datensätze aus der Datei
<code>DUMP.dat.gz</code> extrahiert, die ein Feld <code>003@</code> enthalten, das ein
Unterfeld <code>0</code> besitzt, welches mit dem Wert <code>118540238</code> belegt ist.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ pica filter -s <span style="color:#e6db74">&#39;003@.0 == &#34;118540238&#34;&#39;</span> DUMP.dat.gz -o goethe.dat
</span></span><span style="display:flex;"><span>$ pica print goethe.dat
</span></span><span style="display:flex;"><span>001A $0 1250:01-07-88
</span></span><span style="display:flex;"><span>001B $0 9999:15-04-22 $t 15:15:00.000
</span></span><span style="display:flex;"><span>001D $0 0292:01-08-19
</span></span><span style="display:flex;"><span>001U $0 utf8
</span></span><span style="display:flex;"><span>001X $0 0
</span></span><span style="display:flex;"><span>002@ $0 Tpz
</span></span><span style="display:flex;"><span>003@ $0 118540238
</span></span><span style="display:flex;"><span>003U $a http://d-nb.info/gnd/118540238 $z http://d-nb.info/gnd/185808069 $z http://d-nb.info/gnd/185848826 $z http://d-nb.info/gnd/101488358X $z http://d-nb.info/gnd/1014927390 $z http://d-nb.info/gnd/1022736213 $z http://d-nb.info/gnd/1095607278 $z http://d-nb.info/gnd/1131918517
</span></span><span style="display:flex;"><span>004B $a piz
</span></span><span style="display:flex;"><span>006Y $S isni $0 0000 0001 2099 9104
</span></span><span style="display:flex;"><span>006Y $S wikidata $0 Q5879
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>028A $d Johann Wolfgang $c von $a Goethe
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h2 id="optionen">
  Optionen
  <a class="anchor" href="#optionen">#</a>
</h2>
<ul>
<li><code>-s</code>, <code>--skip-invalid</code> — Überspringt jene Zeilen aus der Eingabe, die
nicht dekodiert werden konnten.</li>
<li><code>-v</code>, <code>--invert-match</code> — Gibt alle Datensätze aus, die <strong>nicht</strong> dem
Filterausdruck entsprechen.</li>
<li><code>-i</code>, <code>--ignore-case</code> — Groß- und Kleinschreibung wird bei Vergleichen
ignoriert.</li>
<li><code>--strsim-threshold &lt;value&gt;</code> — Festlegen des Schwellenwerts beim
Ähnlichkeitsvergleich von Zeichenketten mittels <code>=*</code>.</li>
<li><code>-k</code>, <code>--keep</code> — Es werden nur die Felder eines Datensatzes
beibehalten, die in der Liste aufgeführt werden.</li>
<li><code>-d</code>, <code>--discard</code> — Es werden die Felder eines Datensatzes verworfen,
die in der Liste aufgeführt werden.</li>
<li><code>-F</code>, <code>--file</code> <code>&lt;file&gt;</code> — Es wird der Filterausdruck aus der Datei
<code>&lt;file&gt;</code> eingelesen. Es darf <strong>keine</strong> weitere Angabe eines
Filterausdrucks als Kommandozeilenargument erfolgen!</li>
<li><code>-A</code>, <code>--allow-list</code> <code>&lt;file&gt;</code> — Es werden alle Datensätze ignoriert,
die nicht explizit in der Positivliste<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> auftauchen. Werden mehrere
Positivlisten angegeben, wird die Mengenvereinigung aus allen Listen
gebildet.</li>
<li><code>-D</code>, <code>--deny-list</code> <code>&lt;file&gt;</code> — Es werden alle Datensätze ignoriert,
die in der Negativliste<sup id="fnref1:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> auftauchen. Werden mehrere Negativlisten
angegeben, wird die Mengenvereinigung aus allen Listen gebildet.</li>
<li><code>-l</code>, <code>--limit</code> <code>&lt;n&gt;</code> — Eingrenzung der Ausgabe auf die ersten <code>&lt;n&gt;</code>
(gültigen) Datensätze.</li>
<li><code>--and</code> <code>&lt;expr&gt;</code> — Hinzufügen eines zusätzlichen Filters mittels der
booleschen <code>&amp;&amp;</code>-Verknüpfung. Der ursprüngliche Filterausdruck
<code>&lt;filter&gt;</code> wird zum Ausdruck <code>&lt;filter&gt; &amp;&amp; &lt;expr&gt;</code>.</li>
<li><code>--or</code> <code>&lt;expr&gt;</code> — Hinzufügen eines zusätzlichen Filters mittels der
booleschen <code>||</code>-Verknüpfung. Der ursprüngliche Filterausdruck
<code>&lt;filter&gt;</code> wird zum Ausdruck <code>&lt;filter&gt; || &lt;expr&gt;</code>.</li>
<li><code>--not</code> <code>&lt;expr&gt;</code> — Hinzufügen eines zusätzlichen Filters. Der
ursprüngliche Filterausdruck <code>&lt;filter&gt;</code> wird zum Ausdruck <code>&lt;filter&gt; &amp;&amp; !(&lt;expr&gt;)</code>.</li>
<li><code>-g</code>, <code>--gzip</code> — Komprimieren der Ausgabe im <a href="https://de.wikipedia.org/wiki/Gzip">Gzip</a>-Format.</li>
<li><code>--append</code> — Wenn die Ausgabedatei bereits existiert, wird die
Ausgabe an die Datei angehangen. Ist das Flag nicht gesetzt, wird eine
bestehende Datei überschrieben.</li>
<li><code>--tee &lt;filename&gt;</code> — Abzweigen der Ausgabe in eine zusätzliche Datei.</li>
<li><code>-p</code>, <code>--progress</code> — Anzeige des Fortschritts, der die Anzahl der
eingelesenen gültigen sowie invaliden Datensätze anzeigt. Das
Aktivieren der Option erfordert das Schreiben der Datensätze in eine
Datei mittels <code>-o</code> bzw. <code>--output</code>.</li>
<li><code>-o</code>, <code>--output</code> — Angabe, in welche Datei die Ausgabe geschrieben
werden soll. Standardmäßig wird die Ausgabe in die Standardausgabe
<code>stdout</code> geschrieben. Endet der Dateiname mit dem Suffix <code>.gz</code>, wird
die Ausgabe automatisch im gzip-Format komprimiert.</li>
</ul>
<h2 id="konfiguration">
  Konfiguration
  <a class="anchor" href="#konfiguration">#</a>
</h2>
<!-- TODO: Link zum allgemeinen Kapitel über die Konfigurationsdatei -->
<p>Die Optionen zum Ignorieren invalider Datensätze und zum Komprimieren
der Ausgabe lassen sich in der <code>Pica.toml</code> konfigurieren:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-toml" data-lang="toml"><span style="display:flex;"><span>[<span style="color:#a6e22e">filter</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">skip-invalid</span> = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">gzip</span> = <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><p>Die Werte der Kommandozeilen-Optionen haben Vorrang vor den Werten aus
der Konfiguration.</p>
<h2 id="beispiele">
  Beispiele
  <a class="anchor" href="#beispiele">#</a>
</h2>
<h3 id="invertierte-treffermenge-_invert-match_">
  Invertierte Treffermenge (<em>invert match</em>)
  <a class="anchor" href="#invertierte-treffermenge-_invert-match_">#</a>
</h3>
<p>Mitunter ist es einfacher, einen Ausdruck zu formulieren, der alle
Datensätze umfasst, die nicht in der Treffermenge gewünscht sind. Durch
die Option <code>-v</code>/<code>--invert-match</code> werden dann nur die Datensätze
ausgegeben, die nicht dem Filterkriterum entsprechen.</p>
<p>Beispielweise enthält der Abzug <code>DUMP.dat.gz</code> verschiedene
Normdatensätze. Werden nur die Datensätze benötigt, die <strong>nicht</strong> vom
Satztyp Werk sind, ist es einfacher, zuerst nach den Werken zu suchen
und dann durch das Flag <code>-v</code> alle Datensätze zu erhalten, die nicht dem
Filterkriterium entsprechen.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ pica filter -s -v <span style="color:#e6db74">&#39;002@.0 =^ &#34;Tu&#34;&#39;</span> DUMP.dat.gz -o not-Tu.dat.gz
</span></span><span style="display:flex;"><span>$ pica frequency <span style="color:#e6db74">&#39;002@.0&#39;</span> not-Tu.dat.gz
</span></span><span style="display:flex;"><span>Tsz,2
</span></span><span style="display:flex;"><span>Tg1,1
</span></span><span style="display:flex;"><span>Tp1,1
</span></span><span style="display:flex;"><span>Tpz,1
</span></span><span style="display:flex;"><span>Ts1,1
</span></span></code></pre></div><h3 id="groß--und-kleinschreibung-ingorieren">
  Groß- und Kleinschreibung ingorieren
  <a class="anchor" href="#gro%c3%9f--und-kleinschreibung-ingorieren">#</a>
</h3>
<p>Standardmäßig wird bei Vergleichen von Zeichenketten die Groß- und
Kleinschreibung beachtet. Dies lässt sich mit dem Flag
<code>-i</code>/<code>--ignore-case</code> deaktivieren:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ pica filter -s -i <span style="color:#e6db74">&#39;028A.a == &#34;GOETHE&#34;&#39;</span> DUMP.dat.gz -o goethe.dat
</span></span><span style="display:flex;"><span>$ pica print goethe.dat
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>028A $d Johann Wolfgang $c von $a Goethe
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h3 id="felder-eines-datensatzes-reduzieren">
  Felder eines Datensatzes reduzieren
  <a class="anchor" href="#felder-eines-datensatzes-reduzieren">#</a>
</h3>
<p>Teilweise ist die Anzahl der Felder pro Datensatz sehr groß, was zu
erheblichen Laufzeiteinbußen nachfolgender Datenanalysen führen kann.
Mittels der Optionen <code>-k</code>/<code>--keep</code> bzw. <code>-d</code>/<code>--discard</code> lassen sich
Datensätze auf eine Teilmenge der Felder reduzieren.</p>
<p>Werden für eine Datenanalyse nur die IDN/PPN (<code>003@</code>), die Satzart
(<code>002@</code>) und die Entitätenkodierung (<code>004B</code>) benötigt, können die
Datensätze wie folgt auf die Felder reduziert werden:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ pica filter -s --keep <span style="color:#e6db74">&#39;00[23]@,004B&#39;</span> <span style="color:#e6db74">&#34;003@?&#34;</span> DUMP.dat.gz -o out.dat
</span></span><span style="display:flex;"><span>$ pica print out.dat
</span></span><span style="display:flex;"><span>002@ $0 Tpz
</span></span><span style="display:flex;"><span>003@ $0 118540238
</span></span><span style="display:flex;"><span>004B $a piz
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>002@ $0 Tp1
</span></span><span style="display:flex;"><span>003@ $0 118607626
</span></span><span style="display:flex;"><span>004B $a piz
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Sollen bestimmte Felder entfernt werden, kann dies mit der Option
<code>-d</code>/<code>--discard</code> erfolgen. Der folgende Aufruf entfernt das Feld <code>004B</code>,
sofern vorhanden, aus allen Datensätzen:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ pica filter -s --keep <span style="color:#e6db74">&#39;00[23]@,004B&#39;</span> <span style="color:#e6db74">&#34;003@?&#34;</span> DUMP.dat.gz -o out.dat
</span></span><span style="display:flex;"><span>$ pica filter --discard <span style="color:#e6db74">&#39;004B&#39;</span> <span style="color:#e6db74">&#34;003@?&#34;</span> out.dat -o out2.dat
</span></span><span style="display:flex;"><span>$ pica print out2.dat
</span></span><span style="display:flex;"><span>002@ $0 Tpz
</span></span><span style="display:flex;"><span>003@ $0 118540238
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>002@ $0 Tp1
</span></span><span style="display:flex;"><span>003@ $0 118607626
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Eine Positiv- oder Negativliste muss entweder als <a href="https://de.wikipedia.org/wiki/CSV_%28Dateiformat%29">CSV</a>-Datei
vorliegen oder als eine <a href="https://arrow.apache.org/">Arrow</a>-Datei, die eine <code>idn</code>-Spalte enthält.
Alle Dateien werden automatisch als <a href="https://de.wikipedia.org/wiki/CSV_%28Dateiformat%29">CSV</a>-Datei interpretiert, es
sei denn, die Datei endet mit <code>.ipc</code>, <code>.arrow</code> oder <code>.feather</code>, dann
erfolgt die Interpretation im <a href="https://arrow.apache.org/">Arrow</a>-Format. CSV- bzw. TSV-Dateien
mit der Ending <code>.csv.gz</code> bzw. <code>.tsv.gz</code> werden automatisch entpackt.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a>&#160;<a href="#fnref1:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  </main>

  
</body>
</html>












